AWSTemplateFormatVersion: 2010-09-09
Description: Basic AWS Lambda function template
Transform: AWS::Serverless-2016-10-31
Resources:
  helloWorldFunction:
    Type: AWS::Serverless::Function
    Properties:
      Handler: handler.helloWorldHandler
      Runtime: nodejs10.x
      MemorySize: 128
      Timeout: 10
      Description: A Lambda function that returns the date and time.
      Policies: null
      Events:
        helloWorld:
          Type: Api
          Properties:
            Path: /hello
            Method: get
      CodeUri: helloWorldFunction
  getIPFunction:
    Type: AWS::Serverless::Function
    Properties:
      Handler: handler.getIPHandler
      Runtime: nodejs10.x
      MemorySize: 128
      Timeout: 10
      Description: A Lambda function that returns the IP of the visitor.
      Policies: null
      Events:
        getIP:
          Type: Api
          Properties:
            Path: /ip
            Method: get
      CodeUri: getIPFunction
  getCountryFunction:
    Type: AWS::Serverless::Function
    Properties:
      Handler: handler.getCountryHandler
      Runtime: nodejs10.x
      MemorySize: 128
      Timeout: 10
      Description: A Lambda function that returns the country code of the requestor.
      Policies: null
      Events:
        getCountry:
          Type: Api
          Properties:
            Path: /country
            Method: get
      CodeUri: getCountryFunction
  getDeviceInfoFunction:
    Type: AWS::Serverless::Function
    Properties:
      Handler: handler.getDeviceInfoHandler
      Runtime: nodejs10.x
      MemorySize: 128
      Timeout: 10
      Description: A Lambda function that returns the headers.UserAgent and headers.CloudFront-Is-[deviceList]
        of the requestor.
      Policies: null
      Events:
        getDeviceInfo:
          Type: Api
          Properties:
            Path: /device
            Method: get
      CodeUri: getDeviceInfoFunction
Outputs:
  helloWorld:
    Value:
      Fn::Sub: https://${ServerlessRestApi}.execute-api.${AWS::Region}.amazonaws.com/Prod/hello
  getIP:
    Value:
      Fn::Sub: https://${ServerlessRestApi}.execute-api.${AWS::Region}.amazonaws.com/Prod/ip
  getCountry:
    Value:
      Fn::Sub: https://${ServerlessRestApi}.execute-api.${AWS::Region}.amazonaws.com/Prod/country
  getDeviceInfo:
    Value:
      Fn::Sub: https://${ServerlessRestApi}.execute-api.${AWS::Region}.amazonaws.com/Prod/device
